# Projet Montchauvel

## Présentation du sujet : 
### Le but de ce projet était de récupérer, de traiter et de tracer les données importantes des capteurs, sélectionnées préalablement. Dans les données recherchées on retrouve celles des compteurs thermiques (thermique-solaire et fourneau bouilleur), celles du SMA (photovoltaïque et batteries) et enfin celles des sondes de température. Pour se faire on récupére les données dans un fichier initial que nous devons traiter pour ne garder que les informations essentielles et effectuer des opérations pour avoir des informations issus de ces données (énergie, puissance, incrémentation, ...). Cela crée des fichiers intermédiaires pour chaque groupe de données et nous pouvons ensuite les regrouper dans des fichiers finaux qui sont prêts à être tracé. 

## Mise en place des fichiers initiaux : 
### Pour récupérer les données initiales des compteurs thermiques on utilise directement le logiciel présent avec le compteurs qui va ajouter dans un fichier csv les données toutes les dix minutes. Il y beaucoup de données inutiles dans ce fichier. 
### Pour les sondes thermiques et le SMA, on utilise le logiciel Node-Red qui nous permet d'envoyer des requêtes ModBus chaque heure (pas de temps choisi) aux différents esclaves et cela ajoute une ligne à un csv des différentes données. 
### On a donc quatre fichiers initiaux : un pour les sondes thermiques de la maison et de l'extérieur, un pour les sondes thermiques des ballons d'eau chaudes, un pour le SMA et un pour le SMA. Il n'y a pas de fichiers python à ce niveau là. 


## Mise en place des fichiers intermédiaires : 
### Il s'agit maintenant de réaliser des opérations sur ces fichiers afin d'arriver à des fichiers intermédiaires. Pour se faire pour chaque fichier initial à chaque nouvelle valeur (toutes les dix minutes ou à chaque heure) on exécute un programme Python dédié. Pour automatiser le lancement de ces différents programmes on utilise un logiciel Windows nommé Task Schedular qui permet de programmer le lancement de programmes ou fichiers présents sur l'ordinateur à la fréquence désirée. Ces fichiers pythons vont donc récupérer un fichier initial puis le traiter et recréer un fichier csv intermédiaire en ayant supprimé les valeurs utilisés des fichiers initiaux.
### Ces fichiers intermédiaires vont utiliser du pandas pour lire les fichiers csv et permettre plus facilement les opérations. On placera en index des dataFrame les dates des mesures pour pouvoir ensuite les regrouper plus facilement. On doit donc convertir de manière uniforme les dates car elles ne sont pas toutes dans le même format. On choisit une écriture compréhensible : Année / Mois / Jour Heure - Minute - Secondes. Ces informations vont être capitales pour la suite. 
### Une autre chose importante concerne les compteurs thermiques où on doit supprimer beaucoup de donnés car sont présents dans les fichiers initiaux les données concernant les radiateurs et le plancher chauffant qui ne nous intéressent pas car ils concernent la consommation et non la production. 
### Suite à toutes ces opérations on a maintenant des fichiers intermédiaires pour les sondes de la maison, les sondes des ballons, les compteurs et le SMA. L'architecture choisie a été à chaque fois d'avoir un fichier par jour, dans un dossier correspondant au mois qui lui même est dans un dossier correspond à l'année de la mesure. 

## Mise en place des fichiers finaux : 
### Il s'agit maintenant de regrouper les différentes données dans des fichiers finaux qui ont la même architecture que les fichiers intermédiaires. On veut que chaque ligne corresponde à une mesure et donc regrouper les fichiers selon la date de la mesure. Cela tombe bien car tous les dataFrame ont en index la date de la mesure, écrit de la même manière grâce aux fichiers Python intermédiaires. Malheureusement, on a des mesures qui ne sont pas prises au même instant. En effet, les sondes et le SMA possèdent une mesure par heure alors que les compteurs ont une mesure toutes les dix minutes. De plus le SMA a sa mesure vers la demi-heure : 00h25, 1h25, 2h25, etc alors que les sondes ont leur mesure vers la fin de l'heure : 00h59, 1h59, 2h59, etc. Il faut donc faire un choix qui doit être assez robuste car il peut y avoir des erreurs de mesure dans le sens où un capteur peut avoir un bug et ne pas prendre une mesure à une certaine heure. En effet on a eu notamment quelques soucis avec les sondes thermiques qui semblaient bugger régulièrement. 
### On a donc décidé de garder la demi-heure comme heure de mesure, c'est-à-dire de considérer que sur une plage d'une trentaine de minutes les températures données par les sondes resteraient stables. Ainsi on a pu join les données des sondes sur les données du SMA en gardant comme index les données du SMA. Comme le SMA ne buggait pas après avoir analysé les fichiers intermédiaires de ce dernier on se retrouve avec un fichier contenant 24 mesures à la trentaine de minutes. Concernant les compteurs thermiques où il y avait une mesure toutes les dix minutes on a décidé de faire la somme de chaque mesure (mesure de l'énergie donc donnée extensive) sur une heure pour avoir une seule mesure à chaque heure que l'on donnerait faite à la demi-heure : 00h30, 1h30, 2h30, etc. On aurait pu faire cela dans la partie intermédiaire mais ça ne change fondamentalment pas grand chose. 
### On peut maintenant joindre tous les fichiers en se basant sur l'index des compteurs thermiques. On obtient alors un fichier csv final par jour. 
### Pour exécuter ce programme Python on utilise une fois de plus Task Schedular mais cette fois on va lancer le programme durant la matinée sur les fichiers intermédiaires de la veille pour avoir toutes les données disponibles. 

## Courbes et analyse : 
### Une fois que nos fichiers finaux sont prêts on n'a plus qu'à tracer les courbes. On cherche à tracer les températures, l'état de charge de la batterie et les différentes productions énergétiques en séparant le thermique et l'électrique. On va donc tracer deux graphes, l'un concernant la production électrique et l'autre la production thermique. Enfin pour le moment il n'y a pas d'automatisation du tracé dans le sens où l'on choisit encore manuellement les jours que l'on veut tracer. 
